import{V as e,F as t,A as s,Q as i,W as n,P as a,S as o,a as r,O as h,b as c,M as d,c as l,C as p,d as w,e as m,f as u,g as y,h as k}from"./vendor.80354cb1.js";class b{constructor(){this.init()}init(){this.keys={forward:!1,backward:!1,left:!1,rigth:!1,space:!1,shift:!1,clicked:!1,cmd:!1},document.addEventListener("keydown",(e=>this.onKeyDown(e)),!1),document.addEventListener("keyup",(e=>this.onKeyUp(e)),!1),document.addEventListener("pointerdown",(e=>this.onMouseDown(e)),!1),document.addEventListener("pointerup",(e=>this.onMouseUp(e)),!1),document.addEventListener("touchstart",(e=>this.onMouseDown(e)),!1),document.addEventListener("touchend",(e=>this.onMouseUp(e)),!1)}onKeyDown(e){switch(e.keyCode){case 87:this.keys.forward=!0;break;case 65:this.keys.left=!0;break;case 83:this.keys.backward=!0;break;case 68:this.keys.right=!0;break;case 32:this.keys.space=!0;break;case 16:this.keys.shift=!0;break;case 224:this.keys.cmd=!0}}onMouseDown(e){this.keys.clicked={x:e.clientX,y:e.clientY}}onMouseUp(e){this.keys.clicked=null}onKeyUp(e){switch(e.keyCode){case 87:this.keys.forward=!1;break;case 65:this.keys.left=!1;break;case 83:this.keys.backward=!1;break;case 68:this.keys.right=!1;break;case 32:this.keys.space=!1;break;case 16:this.keys.shift=!1;break;case 224:this.keys.cmd=!1}}}class g{constructor(e){this.init(e)}init(t){this.params=t,this.deceleration=new e(-5e-4,-1e-4,-5),this.acceleration=new e(1.5,.25,50),this.velocity=new e(0,0,0),this.animations={},this.input=new b,this.loadModels(this.params.type)}loadModels(e){"player"===e&&this.loadPlayer()}loadPlayer(){const e=new t;e.setPath("../assets/woman/source/"),e.load("woman.fbx",(e=>{console.log(e,"woman.fbx"),e.scale.setScalar(.01),e.traverse((e=>{e.castShadow=!0,e.receiveShadow=!0})),this.target=e,this.params.scene.add(this.target),this.target.position.set(4,0,5),this.target.rotateY(9.95),this.mixer=new s(this.target);const t=(t,s)=>{const i=e.animations[s],n=this.mixer.clipAction(i);this.animations[t]={clip:i,action:n}};t("idle",3),t("walk",4),t("run",4),this.animations.idle.action.play()}))}update(t){if(!this.target)return;const s=this.velocity,n=new e(s.x*this.deceleration.x,s.y*this.deceleration.y,s.z*this.deceleration.z);n.multiplyScalar(t),n.z=Math.sign(n.z)*Math.min(Math.abs(n.z),Math.abs(s.z)),s.add(n);const a=this.target,o=new i,r=new e,h=a.quaternion.clone(),c=this.acceleration.clone();this.input.keys.shift&&c.multiplyScalar(2),this.input.keys.clicked?(this.animations.walk.action.paused=!1,this.animations.walk.action.play(),s.z+=c.z*t):this.animations.walk.action.paused||(this.animations.walk.action.paused=!0),this.input.keys.backward&&(s.z-=c.z*t),this.input.keys.left&&(r.set(0,1,0),o.setFromAxisAngle(r,4*Math.PI*t*this.acceleration.y),h.multiply(o)),this.input.keys.right&&(r.set(0,1,0),o.setFromAxisAngle(r,4*-Math.PI*t*this.acceleration.y),h.multiply(o)),a.quaternion.copy(h);const d=new e;d.copy(a.position);const l=new e(0,0,1);l.applyQuaternion(a.quaternion),l.normalize();const p=new e(1,0,0);p.applyQuaternion(a.quaternion),p.normalize(),l.multiplyScalar(s.z*t),p.multiplyScalar(s.x*t),a.position.add(l),a.position.add(p),d.copy(a.position),this.mixer&&this.mixer.update(t)}}new class{constructor(e){this.init(e.domElement||"canvas")}init(e){this.renderer=new n({canvas:document.getElementById(e),antialias:!1}),window.addEventListener("resize",(()=>{this.onWindowResize()}),!1),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=a,this.scene=new o,this.camera=new r(74,window.innerWidth/window.innerHeight,.1,1e4),this.camera.position.set(0,10,50),this.orbitControls=new h(this.camera,this.renderer.domElement),this.orbitControls.minDistance=20,this.orbitControls.maxDistance=34,this.orbitControls.autoRotate=!0,this.orbitControls.autoRotateSpeed=.5,this.orbitControls.rotateSpeed=.5,this.generateEnvironment(),this.mixers=[],this.totalTimeElapsed=0,this.previousRAF=null,this.loadAnimatedCharacter({type:"player"}),this.animate()}loadAnimatedCharacter({type:e}){const t={camera:this.camera,scene:this.scene,type:e};this.controls||(this.controls={}),this.controls[e]=new g(t)}animate(){requestAnimationFrame((e=>{null===this.previousRAF&&(this.previousRAF=e),this.animate(),this.renderer.render(this.scene,this.camera),this.step(e-this.previousRAF),this.previousRAF=e}))}step(e){const t=.001*e;if(this.mixers&&this.mixers.map((e=>{e.update(t)})),this.controls)for(let s in this.controls)this.controls[s].update(t);this.controls.player.target&&(this.orbitControls.target=this.controls.player.target.position,this.orbitControls.update())}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}generateEnvironment(){const e=new c(1e4,1e4,1,1),t=new d({color:8164972});t.color.setHSL(.095,1,.75);const s=new l(e,t);s.rotation.x=-Math.PI/2,s.receiveShadow=!0,this.scene.add(s),this.scene.background=new p(1,0,0).setHSL(.6,0,1),this.scene.fog=new w(this.scene.background,1,1e3);const i=new m(4210752);i.position.set(-50,50,50),this.scene.add(i);const n=new u(16755036,2);n.position.set(-50,50,50),n.castShadow=!0,this.scene.add(n);const a=new y(2,32,16);new k({color:16776960});const o=new l(a,t),r=new l(a,t);r.position.x+=5,this.scene.add(o),this.scene.add(r)}}({domElement:"canvas"});
